<?php	// INSERCION DE LA IMAGEN	if (isset($_POST['botonsubirimagen'])) {		$tabla   = $_POST['tabla'];		$id      = $_POST['contenido_id'];		$ruta    = $_POST['ruta'];		$archivo = $_FILES['nombre_archivo'];  // ==> ARRAY !!!		$temp_path = $archivo['tmp_name'];		$nombre_archivo = basename($archivo['name']);		$nombre_archivo = preg_replace('#[^a-z.0-9_-]#i',"-",$nombre_archivo);  // FILTRO Y REMPLAZO DENOMBRE DEL ARCHIVO ORIGINAL		$extensiones = array('jpg','png');		$ex_ext = explode('.', $nombre_archivo);		$extension = end($ex_ext);		if ($_FILES['nombre_archivo']['error'] == 1) {			$mensaje = '<div id="mensaje_negativo">el archivo que seleccionaste es demasiado grande</div>';		} else if ($_FILES['nombre_archivo']['error'] == 4) {			$mensaje = '<div id="mensaje_negativo">no has seleccionado una imagen</div>';		} else if (file_exists('imagenes/pequenas/' . $nombre_archivo)) {			$mensaje = '<div id="mensaje_negativo">el archivo ya existe, seleciona otro diferente o cambia el nombre</div>';		} else if ($extension != $extensiones[0] && $extension != $extensiones[1]) {			$mensaje = '<div id="mensaje_negativo">el tipo de archivos no es valido</div>';		} else {			$destino = "imagenes/grandes/"  . $nombre_archivo;			$ruta1   = "imagenes/pequenas/" . $nombre_archivo;			$ruta2   = "imagenes/medianas/" . $nombre_archivo;			$ruta3   = "imagenes/grandes/"  . $nombre_archivo;			$ruta = $_POST['ruta'];			$arr = explode('/', $ruta);			$archivoparaborrar = $arr[2];			$archivomediano = "imagenes/medianas/" . $archivoparaborrar;			$archivogrande  = "imagenes/grandes/"  . $archivoparaborrar;			if ($archivoparaborrar != 'photo.png') {				if (unlink($ruta)) {					unlink($archivomediano);					unlink($archivogrande);					$mensaje = '<div id="mensaje_positivo">La imagen ha sido eliminada, selecciona una nueva</div>';				} else {					$mensaje = '<div id="mensaje_negativo">No se ha eliminado la imagen! </div>';				}			}			if (move_uploaded_file($temp_path, $destino)) {				$sql  = "UPDATE $tabla SET imagen1 = '{$ruta1}', imagen2 = '{$ruta2}', imagen3 = '{$ruta3}' ";				$sql .= "WHERE id = $id";				$update = mysqli_query($connection, $sql);				if ( mysqli_affected_rows($connection)==1) {					$mensaje = '<div id="mensaje_positivo">Imagen cambiada correctamete</div>';				} else {					$mensaje = "Fall√≥!!<br />" . mysql_error();				}				// REDUCCION DE IMAGEN				require_once("img_reduccion.php");				reducir_imagen($ruta3, $ruta2, $extension, $ruta1);			} else {				$mensajeimagen = "NADA" . mysql_error();			}		}	}?>